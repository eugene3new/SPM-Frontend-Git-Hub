const chalk = require("chalk");
const { name, version } = require("../package.json");
const cliSelect = require("cli-select");
const { execSync } = require("child_process");
const simpleGit = require("simple-git");

const hU = require("./utils/headerUtils");
const vU = require("./utils/versionUtils");

hU.printHeader(name, version);

const versionObj = vU.buildVersionObject(version);

console.log("Select new version number:");
cliSelect({
  values: [
    versionObj.patch.newString,
    versionObj.minor.newString,
    versionObj.major.newString,
  ],
  valueRenderer: (value, selected) => {
    if (selected) {
      return chalk.underline(value);
    }
    return value;
  },
}).then((value) => {
  vU.updateVersionNumber(value, versionObj);
  checkGitDiff();
});

//TODO: Move all these helpers out into modules
const git = simpleGit();
function updateGit() {
  execSync("git push");
}

async function checkGitDiff() {
  try {
    await git.diff(function (res) {
      console.log(res);
    });
  } catch (err) {}
}
